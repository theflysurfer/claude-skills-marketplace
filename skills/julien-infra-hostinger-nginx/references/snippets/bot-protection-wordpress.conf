# ========================================
# Nginx Bot Protection - WordPress Version
# ========================================
# Protection anti-bots adaptée pour les sites WordPress
# N'autorise PAS wp-admin et wp-login.php (contrairement à la version générique)
# À utiliser dans: /etc/nginx/snippets/bot-protection-wordpress.conf

# Bloquer fichiers cachés et dossiers sensibles
location ~ /\. {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Bloquer scans .env (Laravel, Node.js, etc.)
location ~ \.env {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Bloquer XML-RPC (attaques brute force WordPress)
location = /xmlrpc.php {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Bloquer accès direct aux fichiers sensibles WordPress
location ~ (wp-config\.php|wp-content/debug\.log) {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Bloquer fichiers de configuration exposés
location ~ (composer\.json|composer\.lock|package\.json|yarn\.lock|\.htaccess|\.htpasswd|web\.config) {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Bloquer scans d'admin panels non-WordPress
location ~ /(phpmyadmin|pma|adminer|mysql|db|database) {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Bloquer scanners connus par User-Agent
if ($http_user_agent ~* (l9scan|leakix|masscan|shodan|censys|zgrab|sqlmap|nikto|nmap|acunetix)) {
    return 403;
}

# Bloquer requêtes avec chemins suspects
location ~ (phpinfo|info\.php|test\.php|shell\.php|config\.json|config\.php|_all_dbs|telescope) {
    deny all;
    access_log off;
    log_not_found off;
    return 404;
}

# Rate limiting pour wp-login.php (protection brute force)
# À décommenter et configurer le zone dans http block du nginx.conf principal:
# limit_req_zone $binary_remote_addr zone=wp_login:10m rate=10r/m;
# location = /wp-login.php {
#     limit_req zone=wp_login burst=5 nodelay;
#     include snippets/fastcgi-php.conf;
#     fastcgi_pass unix:/var/run/php/php8.3-fpm.sock;
# }
